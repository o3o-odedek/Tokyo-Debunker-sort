<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>도쿄 디벙커 캐릭터 소트</title>
    <style>
        body { font-family: 'Pretendard', -apple-system, sans-serif; background-color: #f8f9fa; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; padding: 20px; }
        h1 { color: #2d3436; margin-bottom: 10px; font-size: 1.5rem; }
        .info { color: #636e72; margin-bottom: 30px; font-size: 0.9rem; }
        
        .progress-container { width: 100%; max-width: 500px; background: #dfe6e9; height: 8px; border-radius: 4px; margin-bottom: 30px; overflow: hidden; }
        .progress-bar { height: 100%; background: #0984e3; width: 0%; transition: width 0.3s; }

        .sorter-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 600px; }
        .btn { background: white; border: 2px solid #dee2e6; border-radius: 12px; padding: 40px 20px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .btn:hover { border-color: #0984e3; background: #f1f7ff; transform: translateY(-2px); }
        
        .sub-btns { grid-column: span 2; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .btn-sub { padding: 20px; font-size: 1rem; background: #f1f2f6; color: #2d3436; height: auto; border-color: #ced4da; }
        .btn-sub:hover { background: #e2e4e9; border-color: #adb5bd; }

        #result { display: none; width: 100%; max-width: 400px; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .result-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f1f2f6; font-size: 1.1rem; }
        .rank { font-weight: bold; color: #0984e3; width: 40px; }
        .name { flex-grow: 1; margin-left: 10px; }
    </style>
</head>
<body>

    <h1>도쿄 디벙커 캐릭터 소트</h1>
    <p class="info">가장 마음에 드는 캐릭터를 골라주세요!</p>
    
    <div class="progress-container"><div class="progress-bar" id="progress"></div></div>

    <div class="sorter-grid" id="main-area">
        <div class="btn" id="left-btn" onclick="select('left')">왼쪽</div>
        <div class="btn" id="right-btn" onclick="select('right')">오른쪽</div>
        
        <div class="sub-btns">
            <div class="btn btn-sub" onclick="select('both')">둘 다 좋다</div>
            <div class="btn btn-sub" onclick="select('skip')">모르겠다</div>
        </div>
    </div>

    <div id="result">
        <h2 style="text-align: center; margin-top: 0;">나의 캐릭터 순위</h2>
        <div id="result-list"></div>
        <button onclick="location.reload()" style="margin-top:25px; width:100%; padding:15px; border:none; background:#0984e3; color:white; border-radius:10px; font-weight:bold; cursor:pointer;">다시 하기</button>
    </div>

<script>
    // 1. 캐릭터 리스트
    const characters = ["카무라이 진", "이시바시 토우마", "루카스 에란트", "후지 카이토", "미도 아란", "하이조노 쇼헤이", "쿠로사기 레오", "카가미 스바루", "코토다마 젠지", "쿠사나기 하쿠", "이사미 유리", "키리사키 지로", "에드워드 하트", "라이카 콜트", "미즈키 루이", "사가라 하루", "시라나미 렌", "오토나시 토와", "호시바미 타이가", "신죠 리츠", "로미오 루치"];
    
    let list = characters.map(name => [name]);
    let mergedList = [];
    let leftArr = [], rightArr = [];
    let leftIdx = 0, rightIdx = 0;
    let tempMerged = [];
    let totalSteps = 0, currentStep = 0;

    function init() {
        // 대략적인 진행 단계 계산 (N log N)
        totalSteps = Math.ceil(characters.length * Math.log2(characters.length));
        nextMerge();
    }

    function nextMerge() {
        // 대결할 쌍(mergedList)이 비었을 때만 체크
        if (mergedList.length === 0) {
            // 리스트에 하나만 남았다면 진짜 종료!
            if (list.length <= 1) {
                showResult(list[0]);
                return;
            }

            // 리스트의 항목들을 대결 쌍으로 만듦
            while (list.length > 1) {
                let a = list.shift();
                let b = list.shift();
                mergedList.push({a, b});
            }
            // 홀수개가 남았다면 다음 라운드로 넘김
            if (list.length === 1) {
                mergedList.push({a: list.shift(), b: null});
            }
        }

        let currentPair = mergedList[0];

        // 부전승 처리 (상대 대결 군이 없는 경우)
        if (currentPair.b === null) {
            list.push(currentPair.a);
            mergedList.shift();
            nextMerge();
            return;
        }

        leftArr = currentPair.a;
        rightArr = currentPair.b;
        leftIdx = 0;
        rightIdx = 0;
        tempMerged = [];
        updateUI();
    }

    function updateUI() {
        document.getElementById('left-btn').innerText = leftArr[leftIdx];
        document.getElementById('right-btn').innerText = rightArr[rightIdx];
        
        currentStep++;
        // 진행률 표시 (최대 100%를 넘지 않게 조절)
        let progress = Math.min((currentStep / totalSteps) * 100, 99);
        document.getElementById('progress').style.width = progress + "%";
    }

    function select(choice) {
        if (choice === 'left') {
            tempMerged.push(leftArr[leftIdx]);
            leftIdx++;
        } else if (choice === 'right') {
            tempMerged.push(rightArr[rightIdx]);
            rightIdx++;
        } else if (choice === 'both') {
            tempMerged.push(leftArr[leftIdx]);
            tempMerged.push(rightArr[rightIdx]);
            leftIdx++;
            rightIdx++;
        } else if (choice === 'skip') {
            if (Math.random() > 0.5) {
                tempMerged.push(leftArr[leftIdx]);
                leftIdx++;
            } else {
                tempMerged.push(rightArr[rightIdx]);
                rightIdx++;
            }
        }

        // 현재 두 그룹 간의 비교가 끝났는지 확인
        if (leftIdx < leftArr.length && rightIdx < rightArr.length) {
            updateUI();
        } else {
            // 남은 요소들을 합쳐서 다시 list에 넣음
            tempMerged = tempMerged.concat(leftArr.slice(leftIdx)).concat(rightArr.slice(rightIdx));
            list.push(tempMerged);
            mergedList.shift(); // 현재 대결 완료된 쌍 제거
            nextMerge(); // 다음 대결로 진행
        }
    }

    function showResult(finalList) {
        document.getElementById('main-area').style.display = 'none';
        document.getElementById('progress').parentNode.style.display = 'none';
        document.querySelector('.info').style.display = 'none';
        const resultDiv = document.getElementById('result');
        const resultList = document.getElementById('result-list');
        resultDiv.style.display = 'block';
        
        finalList.forEach((name, index) => {
            resultList.innerHTML += `
                <div class="result-item">
                    <span class="rank">${index + 1}</span>
                    <span class="name">${name}</span>
                </div>`;
        });
    }

    init();
</script>
</body>
</html>
